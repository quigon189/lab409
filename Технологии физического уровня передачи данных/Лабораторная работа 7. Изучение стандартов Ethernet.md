**Цель:**  
- Освоить настройку параметров Ethernet (скорость, дуплекс, MTU) на уровне ОС.  
- Изучить диагностику сетевых проблем через анализ трафика.  

---

### **Часть 1: Настройка сетевых интерфейсов**  

#### **Задание 1: Изменение скорости и дуплексного режима**  
1. **Установить необходимые инструменты**:
```bash
sudo apt install ethtool arping
```
2. **Изучить установленные утилиты**:
   ```bash
   man ethtool
   man arping
   ```
3. **Определите текущие параметры интерфейса:**  
   ```bash
   ip addr # имя интерфейса по типу enp0s2 
   sudo ethtool enp2s0  # замените enp0s2 на ваш интерфейс  
   ```  
   Зафиксируйте значения скорости (Speed) и дуплекса (Duplex).  

4. **Измените скорость и дуплекс (если поддерживается):**  
   ```bash
   sudo ethtool -s enp2s0 speed 100 duplex full autoneg off  
   ```  
   Проверьте, применились ли настройки.  

6. **Создайте конфликт:**  
   - Выполняйте в паре с соседом
   - На одной машине установите `speed 100 duplex full`, на другой — `speed 10 duplex half`.  
   - Проверьте связь через `ping` и замерьте потерю пакетов.  

7. **Верните стандартные настройки!**

#### **Задание 2: Работа с MTU**  
1. Выполняйте вместе с соседом
2. Что обозначает термин **MTU** (maximum transmission unit)? Какое значение принимает данный параметр в Ethernet сетях? Что такое Jumbo Frames?
3. Установите MTU 9000 (Jumbo Frames) на двух машинах:  
   ```bash  
   sudo ip link set dev enp2s0 mtu 9000  
   ```  
4. Проверьте связь с большими пакетами:  
   ```bash  
   ping -M do -s 8000 <ip соседа>  # -M do — запрет фрагментации  
   ```  
   Если пакеты теряются, уменьшите MTU до 1500 и повторите.  
5. Верните стандартные настройки

---

### **Часть 2: Анализ сетевого трафика**  

#### **Задание 3: Исследование ARP и MAC-адресов**  
1. Установите `tcpdump`:
   ```bash
   sudo apt install tcpdump
   ```
2. Для чего используется утилита `tcpdump`? Изучите как пользоваться данной утилитой:
   ```bash
   man tcpdump
   ```
3. Задание выполняйте совместно с соседом, поочередно запустите на 2 машинах `tcpdump`, а на второй `ping` и `arping`
4. Запустите `tcpdump` на принимающей машине:  
   ```bash  
   sudo tcpdump -i enp2s0 -nn -e 'arp or icmp'  
   ```  
4. С другой машины выполните:  
   ```bash  
   ping <целевой IP>  
   arping <целевой IP>  
   ```  
   *IP адрес можно узнать с помощью команды `ip addr`*
5. Найдите в выводе:  
   - MAC-адреса отправителя и получателя.  
   - Как AR-запросы разрешают адресацию в Ethernet.  

#### **Задание 4: Анализ коллизий (если используется half-duplex)**  
1. Установите необходимые утилиты:
   ```bash
   sudo apt install iperf3
```
2. Для чего применяется утилита `iperf3`? Как правильно использовать данную утилиту?
3. Настройте дуплекс `half` на двух машинах:  
   ```bash  
   sudo ethtool -s enp2s0 duplex half  
   ```  
3. Запустите одновременную отправку данных через `iperf3`:  
   ```bash  
   # На принемающем ПК (сервер):  
   iperf3 -s  
   # На отправляющем ПК (клиенте):  
   iperf3 -c <сервер_IP> -t 30  
   ```  
4. Через `ethtool` проверьте счетчики коллизий и ошибок:  
   ```bash  
   sudo ethtool -S enp2s0 | grep collisions  
   ```
5. **Верните стандартные настройки!**

---

### **Часть 3: Диагностика и оптимизация**  

#### **Задание 5: Поиск узких мест в сети**  
1. Запустите `iperf3` в режиме сервера на одной машине.  
2. На клиенте выполните:  
   ```bash  
   iperf3 -c <сервер_IP> -t 20 -P 4  # 4 параллельных потока  
   ```  
3. Проанализируйте пропускную способность. Если скорость низкая:  
   - Проверьте настройки дуплекса и скорости.  
   - Убедитесь, что MTU одинаков на обоих концах.  

#### **Задание 6: Мониторинг интерфейса**  
1. В реальном времени отслеживайте статистику интерфейса:  
   ```bash  
   sudo watch -n 1 "ethtool -S enp2s0 | grep -E 'rx_packets|tx_packets|errors'"  
   ```  
2. Инициируйте нагрузку с соседнего ПК через `ping -f` и наблюдайте за изменением счетчиков.  

---

### **Итоговый кейс: "Исчезнувшие пакеты"**  
**Ситуация:** В локальной сети пропала связь между двумя машинами.  
**Задачи для студентов:**  
1. Как определить, есть ли физическое соединение (через `ethtool`)?
2. Как проверить настройки MTU, скорости и дуплекса?  
3. Предложить решение на основе данных из `tcpdump`.  

