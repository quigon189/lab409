#### **1. Тема**
Агрегирование каналов связи в сетях Ethernet. Настройка EtherChannel, LACP и различных методов балансировки трафика.

#### **2. Цель работы**
- **Теоретическая:** Изучить принципы агрегирования каналов связи, протоколы LACP/PAgP и методы балансировки трафика в агрегированных каналах.
- **Практическая:** Приобрести навыки настройки EtherChannel, распределения VLAN по агрегированным каналам, настройки различных методов балансировки трафика.

#### **3. Задачи**
1. Построить сетевую топологию с четырьмя коммутаторами.
2. Настроить два VLAN и распределить их между коммутаторами.
3. Настроить агрегированные каналы (EtherChannel) между коммутаторами.
4. Настроить обычные одиночные линки между коммутаторами.
5. Настроить разные методы балансировки трафика для разных агрегированных каналов.
6. Проверить работу агрегированных каналов и отказоустойчивость сети.
7. Проанализировать распределение трафика по каналам.

#### **4. Оборудование и программное обеспечение**
- **Программное обеспечение:** Cisco Packet Tracer
- **Оборудование (в эмуляторе):**
  - Коммутаторы Cisco 2960 - 4 шт.
  - Персональные компьютеры - 8 шт.
  - Соединительные провода

#### **5. Краткие теоретические сведения**

**Агрегирование каналов (EtherChannel)** - технология объединения нескольких физических Ethernet-каналов в один логический для увеличения пропускной способности и обеспечения отказоустойчивости.

**Протоколы агрегирования:**
- **LACP (Link Aggregation Control Protocol)** - стандартный протокол IEEE 802.3ad
- **PAgP (Port Aggregation Protocol)** - проприетарный протокол Cisco

**Методы балансировки нагрузки в EtherChannel:**
Коммутаторы Cisco поддерживают несколько методов распределения трафика по каналам в агрегированной группе:
- **src-mac** - балансировка по исходному MAC-адресу
- **dst-mac** - балансировка по MAC-адресу назначения
- **src-dst-mac** - балансировка по паре исходного и MAC-адреса назначения (по умолчанию)
- **src-ip** - балансировка по исходному IP-адресу
- **dst-ip** - балансировка по IP-адресу назначения
- **src-dst-ip** - балансировка по паре исходного и IP-адреса назначения

#### **6. Порядок выполнения работы**

**6.1. Построение сетевой топологии**
1. Создайте сеть с четырьмя коммутаторами (SW1, SW2, SW3, SW4). (смотри приложенные файлы)
2. Настройте физические соединения
3. Подключите компьютеры:
   - К SW1 и SW3: по 2 ПК в VLAN 10
   - К SW2 и SW4: по 2 ПК в VLAN 20

**6.2. Настройка VLAN**
1. На всех коммутаторах создайте VLAN 10 и VLAN 20:
2. Настройте access порты для компьютеров:
	1. Настройте portfast
	2. Настройте BPDGuard

**6.3. Настройка одиночных линков**
1. Настройте линк между SW1 и SW2 как trunk:
2. Настройте линк между SW3 и SW4 аналогично.

**6.4. Настройка агрегированных каналов (EtherChannel) с LACP**
1. Настройте EtherChannel между SW2 и SW4 с LACP:
   ```
   ! На SW2
   SW2(config)# interface range gigabitEthernet 0/1-2
   SW2(config-if-range)# channel-group 1 mode active  ! LACP active mode
   SW2(config-if-range)# exit
   SW2(config)# interface port-channel 1
   SW2(config-if)# switchport mode trunk
   SW2(config-if)# switchport trunk allowed vlan 10,20
   
   ! На SW4
   SW3(config)# interface range gigabitEthernet 0/1-2
   SW3(config-if-range)# channel-group 1 mode active
   SW3(config-if-range)# exit
   SW3(config)# interface port-channel 1
   SW3(config-if)# switchport mode trunk
   SW3(config-if)# switchport trunk allowed vlan 10,20
   ```

2. Настройте EtherChannel между SW2 и SW3 с LACP
3. Настройте EtherChannel между SW4 и SW1 с LACP

**6.5. Настройка балансировки трафика в агрегированных каналах**
1. На SW2 настройте разные методы балансировки для разных агрегированных каналов:
   ```
   ! Для канала между SW2 и SW3 (port-channel 1) настроим балансировку по исходному IP-адресу
   SW2(config)# port-channel load-balance src-ip
   
   ! Для канала между SW2 и SW4 (port-channel 2) настроим балансировку по MAC-адресам источника и назначения
   SW2(config)# port-channel load-balance src-dst-mac
   ```

2. На SW4 настройте балансировку для канала с SW1:
   ```
   ! Для канала между SW4 и SW1 (port-channel 3) настроим балансировку по IP-адресам источника и назначения
   SW4(config)# port-channel load-balance src-dst-ip
   ```

3. Проверьте текущую настройку балансировки:
   ```
   show etherchannel load-balance
   ```

**6.6. Проверка настройки EtherChannel**
1. Проверьте состояние агрегированных каналов:
   ```
   show etherchannel summary
   show etherchannel port-channel
   show interfaces port-channel 1
   ```

2. Проверьте распределение VLAN:
   ```
   show interfaces trunk
   show vlan brief
   ```

**6.7. Тестирование отказоустойчивости и балансировки**
1. Проверьте связность между компьютерами в разных VLAN:
2. Проверьте отказоустойчивость:
   - Отключите один из каналов в агрегированной группе (например, Gi0/1 в группе 1 на SW2)
   - Убедитесь, что связность сохраняется
   - Проверьте состояние EtherChannel:
   ```
   show etherchannel summary
   ```

3. Восстановите канал и проверьте возврат трафика.
4. Проверьте балансировку нагрузки:
   - Запустите передачу данных между несколькими парами компьютеров
   - Проверьте статистику по портам в агрегированной группе:
   ```
   show interfaces gigabitEthernet 0/1 counters
   show interfaces gigabitEthernet 0/2 counters
   show interfaces port-channel 1 counters
   ```
   - Проанализируйте, как трафик распределяется между физическими каналами

**6.8. Анализ нагрузки на каналы**
1. Проверьте статистику по портам после передачи данных:
   ```
   show interfaces gigabitEthernet 0/1 counters
   show interfaces gigabitEthernet 0/2 counters
   show interfaces port-channel 1 counters
   ```

2. Сравните распределение трафика при разных методах балансировки.

#### **7. Контрольные вопросы**
1. Какие преимущества дает агрегирование каналов связи?
2. В чем разница между LACP и PAgP?
3. Какие режимы работы поддерживает LACP?
4. Какие методы балансировки трафика поддерживаются в EtherChannel?
5. Как проверить состояние агрегированного канала?
6. Какие команды используются для настройки EtherChannel?
7. Как настроить разные методы балансировки для разных агрегированных каналов?
8. Что происходит при выходе из строя одного канала в агрегированной группе?
9. Какие ограничения существуют при настройке EtherChannel?
10. Как проверить текущий метод балансировки нагрузки?

#### **8. Содержание отчета**
- Тема, цель и задачи работы.
- Схема сети с обозначением всех соединений и VLAN.
- Результаты выполнения заданий:
  - Конфигурации коммутаторов (VLAN, access порты)
  - Настройки агрегированных каналов с LACP
  - Настройки методов балансировки трафика
  - Выводы команд `show etherchannel summary`, `show interfaces trunk`
  - Вывод команды `show etherchannel load-balance`
  - Результаты тестирования отказоустойчивости
  - Анализ распределения трафика при разных методах балансировки
- Ответы на контрольные вопросы.
- Выводы по работе с обоснованием эффективности агрегирования каналов и выбора методов балансировки.