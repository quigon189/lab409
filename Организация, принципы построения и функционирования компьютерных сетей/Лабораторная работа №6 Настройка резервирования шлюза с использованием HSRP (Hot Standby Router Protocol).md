#### **1. Цель работы**
- **Теоретическая:** Изучить принципы работы протокола HSRP.
- **Практическая:** Приобрести навыки настройки резервирования шлюзов с балансировкой нагрузки и отслеживанием состояния интерфейсов.

#### **2. Задачи**
1. Построить сетевую топологию с двумя маршрутизаторами в роли шлюзов для двух VLAN.
2. Настроить HSRP для обеспечения отказоустойчивости шлюзов.
3. Настроить отслеживание интерфейсов (interface tracking) в HSRP.
4. Настроить распределение нагрузки с использованием разных активных маршрутизаторов для разных VLAN.
5. Настроить WAN-сегмент и обеспечить маршрутизацию между сетями.
6. Проверить отказоустойчивость и переключение шлюзов.

#### **3. Оборудование и программное обеспечение**
- **Программное обеспечение:** Cisco Packet Tracer
- **Оборудование (в эмуляторе):**
  - Маршрутизаторы Cisco - 2 шт.
  - Коммутаторы Cisco 2960 - 2 шт.
  - Персональные компьютеры - 4 шт.
  - Сервер - 1 шт. (имитация WAN)
  - Соединительные провода

#### **4. Краткие теоретические сведения**

**HSRP (Hot Standby Router Protocol)** - проприетарный протокол Cisco, обеспечивающий резервирование шлюзов по умолчанию.

**Основные понятия:**
- **Active Router** - активный маршрутизатор, обрабатывающий трафик
- **Standby Router** - резервный маршрутизатор, готовый взять на себя функции при отказе активного
- **Virtual IP (VIP)** - виртуальный IP-адрес шлюза
- **Virtual MAC (VMAC)** - виртуальный MAC-адрес формата 0000.0C07.ACXX, где XX - номер группы HSRP

**Принцип работы:**
- Маршрутизаторы в группе HSRP выбирают активный и резервный
- Все хосты используют виртуальный IP-адрес в качестве шлюза
- При отказе активного маршрутизатора резервный берет на себя его функции

#### **5. Порядок выполнения работы**

**5.1. Построение сетевой топологии**
1. Создайте сеть, топология представлена на изображении приложенном к работе.

**5.2. Настройка VLAN на коммутаторах**
1. На SW1 создайте VLAN 10 и VLAN 20:
2. Настройте access порты для ПК:
3. Настройте trunk порты к маршрутизаторам:

**5.3. Настройка IP-адресации**

| VLAN | подсеть         | Шлюз           | R1           | R2           |
| ---- | --------------- | -------------- | ------------ | ------------ |
| 10   | 192.168.10.0/24 | 192.168.10.254 | 192.168.10.1 | 192.168.10.2 |
| 20   | 192.168.20.0/24 | 192.168.20.254 | 192.168.20.2 | 192.168.20.2 |
| WAN  | 10.0.0.0/24     | -              | 10.0.0.1     | 10.0.0.2     |

1. Настройте IP-адреса на сабинтерфейсах маршрутизаторов:
	- VLAN 10: 
		- R1 - 192.168.10.1/24
		- R2 - 192.168.10.2/24
	- VLAN 20:
		- R1 - 192.168.20.1/24
		- R2 - 192.168.20.2/24

2. Настройте IP-адреса на ПК и сервере:
   - PC1, PC3: 192.168.10.10/24, 192.168.10.11/24 (шлюз: 192.168.10.254)
   - PC2, PC4: 192.168.20.10/24, 192.168.20.11/24 (шлюз: 192.168.20.254)
   - Server: 10.0.0.100/24

**5.4. **Настройка HSRP для VLAN10 (группа 10)**
1. На R1 настройте HSRP для VLAN10 (активный для группы 10):
```text
   R1(config)# interface fa0/0.10
   R1(config-if)# standby 10 ip 192.168.10.254  ! Виртуальный IP
   R1(config-if)# standby 10 priority 110     ! Приоритет (больше - выше)
   R1(config-if)# standby 10 preempt          ! Режим преэмпции
   R1(config-if)# standby 10 track fa 0/1
```

2. На R2 настройте HSRP для VLAN10:
```text
R2(config)# interface fa0/0.10
R2(config-if)# standby 10 ip 192.168.10.254
R2(config-if)# standby 10 priority 105
R2(config-if)# standby 10 preempt
R2(config-if)# standby 10 track fa 0/1
```

**5.5. **Настройка HSRP для VLAN20 (группа 20)**
1. На R2 настройте HSRP для VLAN20 (активный для группы 20):
```text
R2(config)# interface fa0/0.20
R2(config-if)# standby 20 ip 192.168.20.1
R2(config-if)# standby 20 priority 110
R2(config-if)# standby 20 preempt
R2(config-if)# standby 20 track fa 0/1
```

2. На R1 настройте HSRP для VLAN20 (резервный для группы 20):

```text
R1(config)# interface fa0/0.20
R1(config-if)# standby 20 ip 192.168.20.1
R1(config-if)# standby 20 priority 105
R1(config-if)# standby 20 preempt
R1(config-if)# standby 20 track fa 0/1
```

**5.6. Проверка работы HSRP**
1. Проверьте состояние HSRP:
```text
show standby brief
show standby detail
show standby interface fa0/0
show standby interface fa0/1
```

2. Проверьте виртуальные MAC-адреса:
```text
   show standby interface fa0/0 detail
```

3. Проверьте ARP-таблицы на ПК:
   - На PC1 выполните: `arp -a`
   - Убедитесь, что шлюз имеет виртуальный MAC-адрес HSRP

**5.7. Тестирование балансировки нагрузки**
1. Проверьте распределение трафика:
    - С PC1 и PC3 (VLAN10) выполните ping к серверу
    - Трафик должен идти через R1 (активный для группы 10)
    - С PC2 и PC4 (VLAN20) выполните ping к серверу
    - Трафик должен идти через R2 (активный для группы 20)
2. Проверьте состояние HSRP групп:

```text
! На R1
show standby brief
! На R2
show standby brief
```


**5.8. Тестирование отказоустойчивости**
1. Проверьте переключение при отказе активного маршрутизатора:
	- Отключите интерфейс fa0/0 на R1 (для VLAN10)
	- Проверьте, что R2 стал активным для группы 10:

```text
show standby brief
```
- Убедитесь, что PC1 и PC3 сохраняют связь с сервером
2. Проверьте отслеживание WAN-интерфейса:
    - Отключите интерфейс serial 0/0/0 на R1
    - Проверьте, что приоритет R1 уменьшился на 30:

```text
show standby interface fa0/0 detail
show standby interface fa0/1 detail
```
- Убедитесь, что R2 стал активным для обеих групп (если его приоритет стал выше)
3. Восстановите интерфейсы и проверьте возврат трафика (преэмпцию).

#### **6. Контрольные вопросы**
1. Каковы основные преимущества HSRP?
2. В чем отличие HSRP от GLBP и VRRP?
3. Какие роли существуют в HSRP и в чем их назначение?
4. Что такое виртуальный MAC-адрес в HSRP и как он формируется?
5. Какие команды используются для мониторинга состояния HSRP?
6. Как настроить отслеживание интерфейсов в HSRP?
7. Что происходит при отказе активного маршрутизатора в HSRP?
8. Как работает механизм преэмпции в HSRP?
9. Как настроить распределение нагрузки между маршрутизаторами с использованием HSRP?
10. Какие меры безопасности можно применить в HSRP?

#### **9. Содержание отчета**
- Тема, цель и задачи работы.
- Схема сети с обозначением всех соединений, IP-адресов и VLAN.
- Результаты выполнения заданий:
  - Конфигурации маршрутизаторов (HSRP, интерфейсы, tracking)
  - Результаты тестирования отказоустойчивости
  - Анализ времени переключения при различных сценариях отказа
- Ответы на контрольные вопросы.
- Выводы по работе с сравнением HSRP с другими протоколами резервирования.