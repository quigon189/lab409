#### **1. Тема**
Настройка расширенных функций STP: Rapid PVST+, PortFast и BPDU Guard в сети с распределенными VLAN.

#### **2. Цель работы**
- **Теоретическая:** Изучить принципы работы Rapid PVST+, назначение PortFast и BPDU Guard в сетях с распределенными VLAN по нескольким линкам.
- **Практическая:** Приобрести навыки настройки распределения VLAN по нескольким линкам и защиты от сетевых петель.

#### **3. Задачи**
1. Построить сетевую топологию с тремя коммутаторами и резервными линками между ними.
2. Настроить VLAN 10 и VLAN 20 с распределением по разным линкам.
3. Настроить Rapid PVST+ с разными корневыми мостами для каждого VLAN.
4. Настроить PortFast и BPDU Guard на портах подключения конечных устройств.
5. Провести тестирование работы PortFast и BPDU Guard.
6. Проверить отказоустойчивость сети при обрыве линков.

#### **4. Оборудование и программное обеспечение**
- **Программное обеспечение:** Cisco Packet Tracer
- **Оборудование (в эмуляторе):**
  - Коммутаторы Cisco 2960 - 3 шт.
  - Персональные компьютеры - 4 шт.
  - Серверы - 2 шт.
  - Соединительные провода

#### **5. Краткие теоретические сведения**

**Rapid PVST+** - обеспечивает быстрое восстановление сети с отдельным деревом для каждого VLAN.

**PortFast** - немедленный переход порта в состояние Forwarding для конечных устройств.

**BPDU Guard** - защита от петель путем отключения порта при получении BPDU.

**Распределение VLAN по линкам** - позволяет балансировать нагрузку и обеспечивать отказоустойчивость.

#### **6. Порядок выполнения работы**

**6.1. Построение сетевой топологии**
1. Создайте сеть с тремя коммутаторами (SW1, SW2, SW3):
   ```
   SW1 ←→ SW2 (2 линка)
   SW1 ←→ SW3 (2 линка)
   SW2 ←→ SW3 (2 линка)
   ```

2. Подключите оборудование:
   - К SW1: ПК1 в VLAN 10, ПК2 в VLAN 20
   - К SW2: ПК3  в VLAN 10, ПК4  в VLAN 20
   - К SW3: Сервер1 в VLAN 10, Сервер2 в VLAN 20

**6.2. Настройка VLAN**
1. Создайте на всех коммутаторах VLAN 10 и VLAN 20:
2. Настройте access порты для конечных устройств:

**6.3. Настройка магистральных портов с распределением VLAN**
1. Настройте два линка между SW1 и SW2, SW2 и SW3, SW3 и SW1 с распределением VLAN:
   ```
   ! Первый линк SW1-SW2 - только VLAN 10
   SW1(config)# interface gigabitEthernet0/1
   SW1(config-if)# switchport mode trunk
   SW1(config-if)# switchport trunk allowed vlan 10
   
   ! Второй линк SW1-SW2 - только VLAN 20
   SW1(config)# interface gigabitEthernet0/2
   SW1(config-if)# switchport mode trunk
   SW1(config-if)# switchport trunk allowed vlan 20
   ```

**6.4. Настройка Rapid PVST+**
1. Включите Rapid PVST+ на всех коммутаторах:
   ```
   SW1(config)# spanning-tree mode rapid-pvst
   ```

2. Настройте корневые мосты SW1 корневой мост для VLAN 10, SW2 корневой мост для VLAN 20.
3. Проверьте конфигурацию STP:
   ```
   show spanning-tree vlan 10
   show spanning-tree vlan 20
   show spanning-tree summary
   ```

**6.5. Настройка PortFast и BPDU Guard**
1. Настройте PortFast на портах конечных устройств:
   ```
   SW1(config)# interface fa0/1
   SW1(config-if)# spanning-tree portfast
   ```

2. Включите BPDU Guard на этих же портах:
   ```
   SW1(config)# interface fa0/1
   SW1(config-if)# spanning-tree bpduguard enable
   ```

**6.6. Тестирование PortFast**
1. Проверьте работу PortFast:
   - Отключите кабель от ПК1 на SW1
   - Подключите кабель обратно
   - Проверьте, что порт сразу перешел в состояние Forwarding:
   ```
   show spanning-tree interface fa0/1
   ```

2. Проверьте время подключения устройства.

**6.7. Тестирование BPDU Guard**
1. Проверьте работу BPDU Guard:
   - Подключите дополнительный коммутатор (SW 4) к порту с BPDU Guard
   - Убедитесь, что порт отключается:
   ```
   show interface status
   show logging
   ```

2. Восстановите порт после срабатывания BPDU Guard:
   ```
   interface fa0/1
   shutdown
   no shutdown
   ```

**6.8. Тестирование отказоустойчивости**
1. Проверьте распределение трафика:
   - С ПК1 (VLAN 10) пингуйте Сервер1 (VLAN 10)
   - С ПК2 (VLAN 20) пингуйте Сервер2 (VLAN 20)

1. Проверьте отказоустойчивость:
   - Перейдите в режим симмуляции
   - Обрывайте поочередно линки между коммутаторами
   - Наблюдайте за переключением трафика
   - Зафиксируйте время восстановления

3. Проверьте распределение VLAN по линкам:
   ```
   show interface trunk
   show spanning-tree vlan 10
   show spanning-tree vlan 20
   ```

#### **7. Контрольные вопросы**
1. Как распределение VLAN по разным линкам влияет на производительность сети?
2. Почему необходимо настраивать разные корневые мосты для разных VLAN?
3. Каковы последствия срабатывания BPDU Guard?
4. Как проверить, что PortFast работает корректно?
5. Какие преимущества дает использование двух линков между коммутаторами?
6. Как происходит маршрутизация между VLAN в данной конфигурации?
7. Какие команды показывают текущее состояние портов STP?
8. Как восстановить порт после срабатывания BPDU Guard?
9. Почему BPDU Guard не следует включать на магистральных портах?
10. Как проверить распределение трафика между линками?

#### **8. Содержание отчета**
- Тема, цель и задачи работы.
- Схема сети с обозначением VLAN и распределением по линкам.
- Результаты выполнения заданий:
  - Конфигурации коммутаторов
  - Выводы команд `show spanning-tree vlan 10` и `show spanning-tree vlan 20`
  - Результаты тестирования PortFast (время подключения)
  - Результаты тестирования BPDU Guard (состояние порта после подключения коммутатора)
  - Таблица тестирования отказоустойчивости
  - Анализ распределения трафика по линкам
- Ответы на контрольные вопросы.
- Выводы по работе.