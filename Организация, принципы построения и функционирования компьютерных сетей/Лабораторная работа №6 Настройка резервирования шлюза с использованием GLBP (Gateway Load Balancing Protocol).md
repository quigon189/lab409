#### **1. Цель работы**
- **Теоретическая:** Изучить принципы работы протокола GLBP, его отличие от HSRP и VRRP.
- **Практическая:** Приобрести навыки настройки резервирования шлюзов с балансировкой нагрузки и отслеживанием состояния интерфейсов.

#### **2. Задачи**
1. Построить сетевую топологию с двумя маршрутизаторами в роли шлюзов для двух VLAN.
2. Настроить GLBP для обеспечения отказоустойчивости шлюзов.
3. Настроить отслеживание интерфейсов (interface tracking) в GLBP.
4. Настроить WAN-сегмент и обеспечить маршрутизацию между сетями.
5. Проверить балансировку нагрузки и отказоустойчивость шлюзов.

#### **3. Оборудование и программное обеспечение**
- **Программное обеспечение:** Cisco Packet Tracer
- **Оборудование (в эмуляторе):**
  - Маршрутизаторы Cisco - 2 шт.
  - Коммутаторы Cisco 2960 - 2 шт.
  - Персональные компьютеры - 4 шт.
  - Сервер - 1 шт. (имитация WAN)
  - Соединительные провода

#### **4. Краткие теоретические сведения**

**GLBP (Gateway Load Balancing Protocol)** - протокол Cisco, обеспечивающий не только резервирование шлюзов, но и балансировку нагрузки между ними.

**Основные понятия:**
- **AVG (Active Virtual Gateway)** - активный виртуальный шлюз, распределяющий MAC-адреса
- **AVF (Active Virtual Forwarder)** - активный виртуальный форвардер, обрабатывающий трафик
- **Virtual IP (VIP)** - виртуальный IP-адрес шлюза
- **Virtual MAC (VMAC)** - виртуальные MAC-адреса, распределяемые AVG

#### **5. Порядок выполнения работы**

**5.1. Построение сетевой топологии**
1. Создайте сеть, топология представлена на изображении приложенном к работе.

**5.2. Настройка VLAN на коммутаторах**
1. На SW1 создайте VLAN 10 и VLAN 20:
2. Настройте access порты для ПК:
3. Настройте trunk порты к маршрутизаторам:

**5.3. Настройка IP-адресации**

| VLAN | подсеть         | Шлюз           | R1           | R2           |
| ---- | --------------- | -------------- | ------------ | ------------ |
| 10   | 192.168.10.0/24 | 192.168.10.254 | 192.168.10.1 | 192.168.10.2 |
| 20   | 192.168.20.0/24 | 192.168.20.254 | 192.168.20.2 | 192.168.20.2 |
| WAN  | 10.0.0.0/24     | -              | 10.0.0.1     | 10.0.0.2     |

1. Настройте IP-адреса на сабинтерфейсах маршрутизаторов:
	- VLAN 10: 
		- R1 - 192.168.10.1/24
		- R2 - 192.168.20.1/24
	- VLAN 20:
		- R1 - 192.168.10.2/24
		- R2 - 192.168.20.2/24

2. Настройте IP-адреса на ПК и сервере:
   - PC1, PC3: 192.168.10.10/24, 192.168.10.11/24 (шлюз: 192.168.10.254)
   - PC2, PC4: 192.168.20.10/24, 192.168.20.11/24 (шлюз: 192.168.20.254)
   - Server: 10.0.0.100/24

**5.4. Настройка GLBP для VLAN10**
1. На R1 настройте GLBP для VLAN10:
   ```
   R1(config)# interface fa0/0.10 !subinterface VLAN 10
   R1(config-subif)# glbp 10 ip 192.168.10.1  ! Виртуальный IP
   R1(config-subif)# glbp 10 priority 110
   R1(config-subif)# glbp 10 preempt
   R1(config-subif)# glbp 10 weighting 100    ! Начальный вес
   R1(config-subif)# glbp 10 weighting track 1 decrement 30  ! Отслеживание
   ```

2. На R2 настройте GLBP для VLAN10:
   ```
   R2(config)# interface fa0/0.10
   R2(config-subif)# glbp 10 ip 192.168.10.1
   R2(config-subif)# glbp 10 priority 105
   R2(config-subif)# glbp 10 weighting 100
   R2(config-subif)# glbp 10 weighting track 1 decrement 30
   ```

**5.5. Настройка GLBP для VLAN20**
1. На R1 настройте GLBP для VLAN20 (обратный приоритет):
   ```
   R1(config)# interface fa0/0.20 ! subinterface VLAN20
   R1(config-subif)# glbp 20 ip 192.168.20.1
   R1(config-subif)# glbp 20 priority 105
   R1(config-subif)# glbp 20 weighting 100
   R1(config-subif)# glbp 20 weighting track 1 decrement 30
   ```

2. На R2 настройте GLBP для VLAN20:
   ```
   R2(config)# interface fa0/0.20
   R2(config-subif)# glbp 20 ip 192.168.20.1
   R2(config-subif)# glbp 20 priority 110
   R2(config-subif)# glbp 20 preempt
   R2(config-subif)# glbp 20 weighting 100
   R2(config-subif)# glbp 20 weighting track 1 decrement 30
   ```

**5.6. Настройка отслеживания интерфейсов (tracking)**
1. На R1 и R2 настройте отслеживание WAN-интерфейса:
   ```
   R1(config)# track 1 interface fa 0/1 line-protocol
   R2(config)# track 1 interface fa 0/1 line-protocol
   ```

2. Проверьте состояние отслеживания:
   ```
   show track
   ```

**5.7. Проверка работы GLBP**
1. Проверьте состояние GLBP:
   ```
   show glbp brief
   show glbp detail
   show glbp 10
   show glbp 20
   ```

2. Проверьте виртуальные MAC-адреса:
   ```
   show glbp 10 detail
   ```
   - Обратите внимание на распределение виртуальных MAC-адресов между маршрутизаторами

3. Проверьте ARP-таблицы на ПК:
   - На PC1 выполните: `arp -a`
   - Убедитесь, что шлюз имеет виртуальный MAC-адрес GLBP

**5.8. Тестирование балансировки нагрузки**
1. Проверьте распределение трафика:
   - С PC1 и PC3 выполните ping к серверу
   - Проверьте, через какой маршрутизатор проходит трафик:
   ```
   ! На R1 и R2
   show glbp 10
   show glbp 20
   ```

2. Проверьте отказоустойчивость:
   - Отключите интерфейс fa 0/1 на R1
   - Проверьте переключение на R2:
   ```
   show glbp 10
   show track
   ```
   - Убедитесь, что вес (weight) уменьшился на 30

3. Восстановите интерфейс и проверьте возврат трафика (преэмпцию).

**5.9. Тестирование отказоустойчивости**
1. Проверьте сценарии:
   - Отказ маршрутизатора R1
   - Отказ интерфейса VLAN10 на R1
   - Отказ WAN-линка на R1

2. Для каждого сценария:
   - Проверьте состояние GLBP
   - Проверьте связность с сервером
   - Измерьте время переключения

#### **6. Контрольные вопросы**
1. Каковы основные преимущества GLBP перед HSRP и VRRP?
2. Какие роли существуют в GLBP и в чем их назначение?
3. Как происходит распределение виртуальных MAC-адресов в GLBP?
4. Что такое отслеживание интерфейсов (tracking) и как оно настраивается?
5. Какие команды используются для мониторинга состояния GLBP?
6. Как настроить балансировку нагрузки между несколькими шлюзами?
7. Что происходит при отказе активного шлюза в GLBP?
8. Как работает механизм преэмпции в GLBP?
9. Как проверить, какой шлюз обрабатывает трафик конкретного хоста?
10. Какие особенности настройки GLBP для нескольких VLAN?

#### **9. Содержание отчета**
- Тема, цель и задачи работы.
- Схема сети с обозначением всех соединений, IP-адресов и VLAN.
- Результаты выполнения заданий:
  - Конфигурации маршрутизаторов (GLBP, интерфейсы, tracking)
  - Выводы команд `show glbp brief`, `show glbp detail`
  - Результаты тестирования балансировки нагрузки
  - Результаты тестирования отказоустойчивости
  - Анализ времени переключения при различных сценариях отказа
- Ответы на контрольные вопросы.
- Выводы по работе с сравнением GLBP с другими протоколами резервирования.