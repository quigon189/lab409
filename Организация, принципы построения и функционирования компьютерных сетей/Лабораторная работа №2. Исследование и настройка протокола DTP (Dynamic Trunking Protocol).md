#### **1. Тема**
Протокол DTP (Dynamic Trunking Protocol). Изучение механизмов согласования режимов работы портов на коммутаторах Cisco.

#### **2. Цель работы**
- **Теоретическая:** Изучить назначение и принципы работы протокола DTP, режимы работы портов коммутатора.
- **Практическая:** Приобрести навыки анализа DTP-сообщений, настройки различных режимов работы портов и исследования процесса их согласования.

#### **3. Задачи**
1. Исследовать процесс согласования режима работы портов между коммутаторами в режиме "dynamic auto".
2. Проанализировать формат DTP-сообщений и их поля.
3. Изучить согласование режимов между портами в разных режимах ("dynamic auto" и "trunk").
4. Исследовать передачу тегированного трафика через trunk-соединение.

#### **4. Оборудование и программное обеспечение**
- **Программное обеспечение:** Cisco Packet Tracer.

#### **5. Краткие теоретические сведения**

**DTP (Dynamic Trunking Protocol)** - проприетарный протокол компании Cisco, который позволяет коммутаторам автоматически согласовывать режим работы портов (Access или Trunk). 

**Режимы работы портов:**
- **access** - порт работает в режиме доступа, передает трафик только одного VLAN.
- **trunk** - порт работает в магистральном режиме, передает тегированный трафик нескольких VLAN.
- **dynamic auto** - пассивно ожидает запрос на установление trunk-соединения.
- **dynamic desirable** - активно пытается установить trunk-соединение.

**Согласование режимов:** Коммутаторы обмениваются DTP-сообщениями, содержащими информацию о желаемом режиме работы. Результат согласования зависит от режимов на обоих концах соединения.

**Мультикастовый адрес DTP:** 0100.0ccc.cccc - используется для отправки DTP-сообщений.

#### **6. Порядок выполнения работы**

**6.1. Задание 1: Исследование согласования портов в режиме "dynamic auto"**

1. Добавьте в рабочую область 2 коммутатора Cisco.
2. Не соединяя коммутаторы, проверьте режим работы портов командой:
   ```
   show interfaces switchport
   ```
   Убедитесь, что порты находятся в режиме "dynamic auto".
3. Соедините коммутаторы кабелем.
4. В режиме симуляции отфильтруйте трафик по протоколу DTP.
5. Проанализируйте DTP-сообщения:
   - Сравните MAC-адрес получателя с мультикастовым адресом 0100.0ccc.cccc
   - Изучите поля заголовка DTP:
     - **DTP Type** - предложенный режим работы
     - **Neighbor MAC-address** - MAC-адрес порта отправителя
6. Проследите за обменом DTP-сообщениями между коммутаторами.
7. После согласования проверьте результирующий режим работы портов командой:
   ```
   show interfaces switchport
   ```

**6.2. Задание 2: Исследование передачи трафика VLAN через DTP-согласование**

1. **Сборка базовой сети:**
   - Добавьте 2 коммутатора (SW1, SW2) и 6 компьютеров
   - Создайте на обоих коммутаторах VLAN 10, 20, 30 с именами:
     ```
     SW1(config)# vlan 10
     SW1(config-vlan)# name Sales
     SW1(config)# vlan 20
     SW1(config-vlan)# name IT
     SW1(config)# vlan 30
     SW1(config-vlan)# name Management
     ```

2. **Настройка портов Access:**
   - На SW1 назначьте порты:
     ```
     SW1(config)# interface range fa0/1-2
     SW1(config-if-range)# switchport mode access
     SW1(config-if-range)# switchport access vlan 10
     ```
     ```
     SW1(config)# interface range fa0/3-4
     SW1(config-if-range)# switchport mode access
     SW1(config-if-range)# switchport access vlan 20
     ```
     ```
     SW1(config)# interface range fa0/5-6
     SW1(config-if-range)# switchport mode access
     SW1(config-if-range)# switchport access vlan 30
     ```

   - Аналогично настройте SW2 с портами fa0/1-6 для соответствующих VLAN

3. **Настройка IP-адресации на ПК:**
   - VLAN 10: PC1 - 192.168.10.10/24, PC2 - 192.168.10.20/24
   - VLAN 20: PC3 - 192.168.20.10/24, PC4 - 192.168.20.20/24  
   - VLAN 30: PC5 - 192.168.30.10/24, PC6 - 192.168.30.20/24

4. **Настройка trunk между SW1 и SW2:**
   - На портах fa0/24 обоих коммутаторов:
     ```
     SW1(config)# interface fa0/24
     SW1(config-if)# switchport mode trunk
     SW1(config-if)# switchport trunk allowed vlan 10,20,30
     ```

5. **Добавление третьего коммутатора:**
   - Добавьте SW3 и настройте на порте fa0/1 режим trunk:
     ```
     SW3(config)# interface fa0/1
     SW3(config-if)# switchport mode trunk
     ```
   - Соедините SW3 с SW1 через порты fa0/23

6. **Проверка согласования режимов:**
   - На SW1 и SW3 выполните команду:
     ```
     show interfaces fa0/23 switchport
     ```
   - Определите, в каком режиме согласовались порты
   - Проверьте список разрешенных VLAN командой:
     ```
     show interfaces trunk
     ```

7. **Исследование передачи широковещательного трафика:**
   - Перейдите в режим симуляции
   - Отправьте ARP-запрос с PC1 (VLAN 10) на широковещательный адрес
   - Проследите, доходит ли кадр до SW3 и в каком VLAN он передается
   - Повторите для PC3 (VLAN 20) и PC5 (VLAN 30)
   - Сделайте выводы о том, трафик каких VLAN проходит до SW3

#### **7. Контрольные вопросы**
1. Каково назначение протокола DTP в сетях Cisco?
2. Какие режимы работы портов поддерживает протокол DTP?
3. Опишите процесс согласования режимов работы портов между коммутаторами.
4. Какие угрозы безопасности могут возникнуть при неправильной настройке режимов работы портов?
5. В каких случаях рекомендуется отключать DTP?
6. Какой мультикастовый адрес используется для DTP-сообщений и какие еще протоколы используют этот адрес?
7. Какая команда позволяет просмотреть текущий режим работы порта коммутатора?

#### **8. Содержание отчета**
- Тема, цель и задачи работы.
- Схема сети для каждого задания.
- Результаты выполнения заданий:
  - Скриншоты DTP-сообщений с выделенными полями заголовка.
  - Скриншоты результатов команд `show interfaces switchport` до и после согласования.
  - Скриншоты передачи ARP-запроса через trunk-соединение.
  - Ответы на вопросы по каждому заданию.
- Ответы на контрольные вопросы.
- Выводы по работе.